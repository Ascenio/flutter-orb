description: >
  Install your flutter packages with automated caching and best practices applied. Requires lock file.
parameters:
  app-dir:
    default: .
    description: Path to the directory containing your pubspec.yaml file. Not needed if pubspec.yaml lives in the root.
    type: string
steps:
  - restore_cache:
      keys:
        - 'dart-dependencies-{{ checksum "<< parameters.app-dir >>/pubspec.lock" }}'
        - dart-dependencies-
  - run:
      name: Install Dependencies
      command: flutter pub get
      working_directory: <<parameters.app_dir>>
  - run:
      name: Build
      command: flutter packages pub run build_runner build
      working_directory: <<parameters.app_dir>>
  - save_cache:
      paths:
        - .dart_tool
      key: 'dart-dependencies-{{ checksum "<< parameters.app-dir >>/pubspec.lock" }}'
